{"ast":null,"code":"import \"antd-mobile/lib/grid/style/css\";\nimport _Grid from \"antd-mobile/lib/grid\";\nimport \"antd-mobile/lib/input-item/style/css\";\nimport _InputItem from \"antd-mobile/lib/input-item\";\nimport \"antd-mobile/lib/nav-bar/style/css\";\nimport _NavBar from \"antd-mobile/lib/nav-bar\";\nimport \"antd-mobile/lib/icon/style/css\";\nimport _Icon from \"antd-mobile/lib/icon\";\nimport \"antd-mobile/lib/list/style/css\";\nimport _List from \"antd-mobile/lib/list\";\n\nvar _dec,\n    _class,\n    _jsxFileName = \"/Users/loki/feature1/Handy-Booking-Management-System/src/component/chat/chat.js\";\n\nimport React from 'react'; // import io from 'socket.io-client'\n\nimport { getMsgList, recvMsg, sendMsg, readMsg } from '../../redux/chat.redux';\nimport { connect } from 'react-redux';\nimport { getChatId } from '../../util'; //发起连接,链接服务器\n// const socket = io('ws://localhost:9093')\n\nlet Chat = (_dec = connect(state => state, {\n  getMsgList,\n  recvMsg,\n  sendMsg,\n  readMsg\n}), _dec(_class = class Chat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      msg: []\n    };\n  }\n\n  componentDidMount() {\n    if (!this.props.chat.chatmsg.length) {\n      this.props.getMsgList();\n      this.props.recvMsg();\n    }\n  } //退出路由时调用\n\n\n  componentWillUnmount() {\n    //对面聊天对象的id\n    const to = this.props.match.params.user;\n    this.props.readMsg(to);\n  } //修正Grid组件bug\n\n\n  fixCarousel() {\n    setTimeout(function () {\n      window.dispatchEvent(new Event('resize'));\n    }, 0);\n  }\n\n  handleSubmit() {\n    const from = this.props.user._id;\n    const to = this.props.match.params.user;\n    const msg = this.state.text;\n    this.props.sendMsg({\n      from,\n      to,\n      msg\n    });\n    this.setState({\n      text: '',\n      showEmoji: false //判断是否展示emoji表情\n\n    });\n  }\n\n  render() {\n    //添加emoji表情\n    const emoji = '😀 😃 😄 😁 😆 😅 😂 😊 😇 🙂 🙃 😉 😌 😍 😘 😗 😙 😚 😋 😜 😝 😛 🤑 🤗 🤓 😎 😏 😒 😞 😔 😟 😕 🙁 😣 😖 😫 😩 😤 😠 😡 😶 😐 😑 😯 😦 😧 😮 😲 😵 😳 😱 😨 😰 😢 😥 😭 😓 😪 😴 🙄 🤔 😬 🤐 😷 🤒 🤕 😈 👿 👹 👺 💩 👻 💀 ☠️ 👽 👾 🤖 🎃 😺 😸 😹 😻 😼 😽 🙀 😿 😾 👐 🙌 👏 🙏 👍 👎 👊 ✊ 🤘 👌 👈 👉 👆 👇 ✋  🖐 🖖 👋  💪 🖕 ✍️  💅 🖖 💄 💋 👄 👅 👂 👃 👁 👀 '.split(' ').filter(v => v).map(v => ({\n      text: v\n    }));\n    console.log(\"chat-->props\", this.props); //聊天时对面的id\n\n    const userid = this.props.match.params.user;\n    const Item = _List.Item;\n    const users = this.props.chat.users;\n\n    if (!users || !users[userid]) {\n      return null;\n    }\n\n    const chatid = getChatId(userid, this.props.user._id);\n    const chatmsgs = this.props.chat.chatmsg.filter(v => v.chatid === chatid);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat-page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(_NavBar, {\n      mode: \"dark\",\n      className: \"chat-top-bar\",\n      icon: /*#__PURE__*/React.createElement(_Icon, {\n        type: \"left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 27\n        }\n      }),\n      onLeftClick: () => {\n        this.props.history.goBack();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 17\n      }\n    }, users[userid].name), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 17\n      }\n    }, chatmsgs.map(v => {\n      //用户头像\n      const avatar = require(`../img/${users[v.from].avatar}.png`); // console.log(\"chat-->msg\",v);\n\n\n      return v.from === userid ? /*#__PURE__*/React.createElement(_List, {\n        key: v._id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Item, {\n        thumb: avatar,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 33\n        }\n      }, v.content)) : /*#__PURE__*/React.createElement(_List, {\n        key: v._id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Item, {\n        extra: /*#__PURE__*/React.createElement(\"img\", {\n          alt: \"\\u5934\\u50CF\",\n          src: avatar,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 43\n          }\n        }),\n        className: \"chat-me\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 33\n        }\n      }, v.content));\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"stick-footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(_List, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\",\n      value: this.state.text,\n      onChange: v => {\n        this.setState({\n          text: v\n        });\n      },\n      extra: /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        style: {\n          marginRight: 15\n        },\n        onClick: () => {\n          this.setState({\n            showEmoji: !this.state.showEmoji\n          });\n          this.fixCarousel();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 37\n        }\n      }, \"\\uD83D\\uDE03\"), /*#__PURE__*/React.createElement(\"span\", {\n        onClick: () => this.handleSubmit(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 37\n        }\n      }, \"\\u53D1\\u9001\")),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 25\n      }\n    })), this.state.showEmoji ? /*#__PURE__*/React.createElement(_Grid, {\n      data: emoji,\n      columnNum: 9,\n      carouselMaxRow: 4,\n      isCarousel: true,\n      onClick: el => {\n        this.setState({\n          text: this.state.text + el.text\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 43\n      }\n    }) : null));\n  }\n\n}) || _class);\nexport default Chat;","map":{"version":3,"sources":["/Users/loki/feature1/Handy-Booking-Management-System/src/component/chat/chat.js"],"names":["React","getMsgList","recvMsg","sendMsg","readMsg","connect","getChatId","Chat","state","Component","constructor","props","text","msg","componentDidMount","chat","chatmsg","length","componentWillUnmount","to","match","params","user","fixCarousel","setTimeout","window","dispatchEvent","Event","handleSubmit","from","_id","setState","showEmoji","render","emoji","split","filter","v","map","console","log","userid","Item","users","chatid","chatmsgs","history","goBack","name","avatar","require","content","marginRight","el"],"mappings":"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","sourcesContent":["import React from 'react'\n// import io from 'socket.io-client'\nimport {List,InputItem, NavBar,Icon,Grid} from 'antd-mobile'\nimport {getMsgList,recvMsg,sendMsg,readMsg} from '../../redux/chat.redux'\nimport {connect} from 'react-redux'\nimport {getChatId} from '../../util'\n\n\n//发起连接,链接服务器\n// const socket = io('ws://localhost:9093')\n@connect(\n    state => state,\n    {getMsgList,recvMsg,sendMsg,readMsg}\n)\nclass Chat extends React.Component{\n    constructor(props){\n        super(props)\n        this.state={text:'',msg:[]}\n\n    }\n    componentDidMount(){  \n        if(!this.props.chat.chatmsg.length){\n            this.props.getMsgList()\n            this.props.recvMsg()\n        }\n    }\n    //退出路由时调用\n    componentWillUnmount(){\n        //对面聊天对象的id\n\t\tconst to = this.props.match.params.user\n\t\tthis.props.readMsg(to)\n\t}\n    //修正Grid组件bug\n    fixCarousel(){\n\t\tsetTimeout(function(){\n\t\t\twindow.dispatchEvent(new Event('resize'))\n\t\t},0)\n\t}\n    handleSubmit(){\n        const from = this.props.user._id\n\t\tconst to = this.props.match.params.user\n\t\tconst msg = this.state.text\n        this.props.sendMsg({from,to,msg})\n\t\tthis.setState({\n            text:'',\n            showEmoji:false   //判断是否展示emoji表情\n\t\t})\n    }\n    render(){\n        //添加emoji表情\n        const emoji = '😀 😃 😄 😁 😆 😅 😂 😊 😇 🙂 🙃 😉 😌 😍 😘 😗 😙 😚 😋 😜 😝 😛 🤑 🤗 🤓 😎 😏 😒 😞 😔 😟 😕 🙁 😣 😖 😫 😩 😤 😠 😡 😶 😐 😑 😯 😦 😧 😮 😲 😵 😳 😱 😨 😰 😢 😥 😭 😓 😪 😴 🙄 🤔 😬 🤐 😷 🤒 🤕 😈 👿 👹 👺 💩 👻 💀 ☠️ 👽 👾 🤖 🎃 😺 😸 😹 😻 😼 😽 🙀 😿 😾 👐 🙌 👏 🙏 👍 👎 👊 ✊ 🤘 👌 👈 👉 👆 👇 ✋  🖐 🖖 👋  💪 🖕 ✍️  💅 🖖 💄 💋 👄 👅 👂 👃 👁 👀 '\n\t\t\t\t\t\t\t\t\t\t.split(' ')\n\t\t\t\t\t\t\t\t\t\t.filter(v=>v)\n\t\t\t\t\t\t\t\t\t\t.map(v=>({text:v}))\n        console.log(\"chat-->props\",this.props);\n        //聊天时对面的id\n        const userid = this.props.match.params.user\n        const Item = List.Item\n        const users = this.props.chat.users\n        if(!users||!users[userid]){\n            return null\n        }\n        const chatid = getChatId(userid,this.props.user._id)\n        const chatmsgs = this.props.chat.chatmsg.filter(v=>v.chatid===chatid)\n        return(\n            <div id='chat-page'>\n                <NavBar \n                    mode='dark'\n                    className='chat-top-bar'\n                    icon={<Icon type=\"left\" />}\n\t\t\t\t\tonLeftClick={()=>{\n\t\t\t\t\t\tthis.props.history.goBack()\n\t\t\t\t\t}}\n                 >\n                    {/* 对方的id */}\n                    {users[userid].name}\n                </NavBar>\n                <div className='chat-content'>\n                    {chatmsgs.map(v=>{\n                        //用户头像\n                        const avatar = require(`../img/${users[v.from].avatar}.png`)\n                        // console.log(\"chat-->msg\",v);\n                        return v.from===userid?(\n                            <List key={v._id}>\n                                <Item\n                                    thumb={avatar}\n                                >{v.content}</Item>\n                            </List>\n                        ):(\n                            <List key={v._id}>\n                                <Item \n                                   extra={<img alt='头像' src={avatar} />}\n                                    className='chat-me'>{v.content}</Item>\n                            </List>\n                        )\n                        \n                    })}\n                </div>\n                {/* 脚部输入框 */}\n                <div className=\"stick-footer\">\n                    <List>\n                        <InputItem\n                            placeholder='请输入'\n                            value={this.state.text}\n                            onChange={v=>{\n                                this.setState({text:v})\n                            }}\n                            extra={\n                                <div>\n                                    <span\n                                        style={{marginRight:15}}\n\t\t\t\t\t\t\t\t\t\tonClick={()=>{\n\t\t\t\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\t\t\t\tshowEmoji:!this.state.showEmoji\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\tthis.fixCarousel()\n\t\t\t\t\t\t\t\t\t\t}}\n                                    >😃</span>\n                                    <span onClick={()=>this.handleSubmit()}>发送</span>\n                                </div>}\n                        ></InputItem>\n                    </List>\n                    {this.state.showEmoji?<Grid\n                        data={emoji}\n                        columnNum={9}\n                        carouselMaxRow={4}\n                        isCarousel={true}\n                        onClick={el=>{\n                            this.setState({\n                                text:this.state.text+el.text\n                            })\n                        }}\n                    />\n                    :null}\n                </div>\n            </div>\n        )\n    }\n}\nexport default Chat"]},"metadata":{},"sourceType":"module"}