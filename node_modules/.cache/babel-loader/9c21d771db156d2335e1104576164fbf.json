{"ast":null,"code":"// user.redux.js\nimport axios from 'axios'; // 用axios做请求\n\nimport { getRedirectPath } from '../utils'; // 定义常量\n\nconst REGISTER_SUCCESS = 'REGISTER_SUCCESS'; // 注册成功\n\nconst GET_USER_INFO = 'GET_USER_INFO';\nconst toDoFail = 'toDoFail';\nconst LoginSuccess = 'LoginSuccess';\nconst LogOutSuccess = 'LogOutSuccess'; // state初始值\n\nconst initState = {\n  redirectTo: '',\n  // 完成之后跳到哪里\n  user: '',\n  // 账号\n  pwd: '',\n  // 密码\n  type: '',\n  // 用户类型\n  msg: '',\n  // 错误消息\n  isLogin: false // \n\n};\nexport function user(state = initState, action) {\n  switch (action.type) {\n    case LoginSuccess:\n      return { ...state,\n        msg: '',\n        redirectTo: getRedirectPath(action.payload),\n        isLogin: true,\n        ...action.payload\n      };\n\n    case REGISTER_SUCCESS:\n      return { ...state,\n        msg: '',\n        redirectTo: getRedirectPath(action.payload),\n        isLogin: true,\n        ...action.payload\n      };\n\n    case GET_USER_INFO:\n      return { ...state,\n        ...action.payload\n      };\n\n    case LogOutSuccess:\n      return { ...initState,\n        redirectTo: '/login'\n      };\n\n    case toDoFail:\n      return { ...state,\n        isLogin: false,\n        msg: action.msg\n      };\n\n    default:\n      return state;\n  }\n}\n\nfunction loginSuccess(obj) {\n  const {\n    pwd,\n    ...data\n  } = obj;\n  return {\n    type: LoginSuccess,\n    payload: data\n  };\n}\n\nfunction logOutSuccess() {\n  return {\n    type: LogOutSuccess\n  };\n}\n\nfunction errorMsg(msg) {\n  return {\n    msg,\n    type: toDoFail\n  };\n}\n\nfunction registerSuccess(data) {\n  return {\n    type: REGISTER_SUCCESS,\n    payload: data\n  };\n}\n\nexport function getUserInfo(userInfo) {\n  return {\n    type: GET_USER_INFO,\n    payload: userInfo\n  };\n}\nexport function update(data) {\n  return dispatch => {\n    axios.post('/user/update', data).then(res => {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(loginSuccess(res.data.data));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n} //login\n\nexport function login({\n  user,\n  pwd\n}) {\n  if (!user || !pwd) {\n    return errorMsg('账号密码不能为空');\n  }\n\n  return dispatch => {\n    axios.post('/user/login', {\n      user,\n      pwd\n    }).then(res => {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(loginSuccess(res.data.data));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n} // register是一个action creator ，返回的action供user这个reducer使用，从而改变state\n\nexport function register({\n  user,\n  pwd,\n  repeatpwd,\n  type\n}) {\n  if (!user || !pwd || !type) {\n    errorMsg('账号密码不能为空');\n  }\n\n  if (pwd !== repeatpwd) {\n    errorMsg('两次密码不一致');\n  }\n\n  return dispatch => {\n    axios.post('/user/register', {\n      user,\n      pwd,\n      type\n    }).then(res => {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(registerSuccess(res.data.data));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n}\nexport function logOut() {\n  return dispatch => {\n    axios.get('/user/logOut').then(res => {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(logOutSuccess(res.data.data));\n      } else {\n        dispatch(toDoFail(res.data.msg));\n      }\n    });\n  };\n}","map":{"version":3,"sources":["/Users/loki/feature1/Handy-Booking-Management-System/src/redux/user.redux.js"],"names":["axios","getRedirectPath","REGISTER_SUCCESS","GET_USER_INFO","toDoFail","LoginSuccess","LogOutSuccess","initState","redirectTo","user","pwd","type","msg","isLogin","state","action","payload","loginSuccess","obj","data","logOutSuccess","errorMsg","registerSuccess","getUserInfo","userInfo","update","dispatch","post","then","res","status","code","login","register","repeatpwd","logOut","get"],"mappings":"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","sourcesContent":["// user.redux.js\nimport axios from 'axios'; // 用axios做请求\nimport {getRedirectPath} from '../utils';\n\n// 定义常量\nconst REGISTER_SUCCESS = 'REGISTER_SUCCESS'; // 注册成功\nconst GET_USER_INFO = 'GET_USER_INFO';\nconst toDoFail = 'toDoFail';\nconst LoginSuccess = 'LoginSuccess';\nconst LogOutSuccess ='LogOutSuccess';\n\n// state初始值\nconst initState = {\n    redirectTo: '', // 完成之后跳到哪里\n    user: '', // 账号\n    pwd: '', // 密码\n    type: '', // 用户类型\n    msg: '', // 错误消息\n    isLogin: false // \n}\n\nexport function user(state=initState,action) {\n    switch (action.type) {\n       case LoginSuccess:\n            return {...state, msg:'',redirectTo:getRedirectPath(action.payload),isLogin:true,...action.payload}\n       case REGISTER_SUCCESS:\n            return {...state, msg:'',redirectTo:getRedirectPath(action.payload),isLogin:true,...action.payload}\n       case GET_USER_INFO:\n           return {...state,...action.payload}\n       case LogOutSuccess:\n\t\t   return {...initState,redirectTo:'/login'}\n       case toDoFail:\n            return {...state, isLogin:false, msg:action.msg}\n       default:\n            return state;\n    }\n}\nfunction loginSuccess(obj){\n\tconst {pwd,...data} = obj\n\treturn {type: LoginSuccess, payload:data}\n}\nfunction logOutSuccess(){\n    return { type:LogOutSuccess };\n}\nfunction errorMsg(msg){\n    return { \n        msg, \n        type:toDoFail \n    }\n}\n\nfunction registerSuccess(data) {\n    return {\n        type:REGISTER_SUCCESS, payload:data\n    }\n}\nexport function getUserInfo(userInfo) {\n    return {\n        type: GET_USER_INFO,\n        payload: userInfo\n    }    \n}\nexport function update(data){\n\treturn dispatch=>{\n\t\taxios.post('/user/update',data)\n\t\t\t.then(res=>{\n\t\t\t\tif (res.status===200&&res.data.code===0) {\n\t\t\t\t\tdispatch(loginSuccess(res.data.data))\n\t\t\t\t}else{\n\t\t\t\t\tdispatch(errorMsg(res.data.msg))\n\t\t\t\t}\n\t\t\t})\n\t}\n}\n//login\nexport function login({user,pwd}) {\n    if(!user || !pwd) {\n        return errorMsg('账号密码不能为空')\n    }\n    return dispatch => {\n        axios.post('/user/login',{user,pwd})\n            .then(res => {\n                if(res.status === 200 && res.data.code === 0) {\n                    dispatch(loginSuccess(res.data.data))\n                }else {\n                    dispatch(errorMsg(res.data.msg))\n                }\n            })\n    }\n}\n// register是一个action creator ，返回的action供user这个reducer使用，从而改变state\nexport function register({user,pwd,repeatpwd,type}) {\n    if(!user || !pwd|| !type) {\n        errorMsg('账号密码不能为空')\n    }\n    if(pwd !== repeatpwd) {\n        errorMsg('两次密码不一致')\n    }\n    return dispatch => {\n        axios.post('/user/register',{user,pwd,type})\n            .then(res => {\n                if(res.status === 200 && res.data.code === 0) {\n                    dispatch(registerSuccess(res.data.data))\n                }else {\n                    dispatch(errorMsg(res.data.msg))\n                }\n            })\n    }\n}\nexport function logOut() {\n    return dispatch => {\n        axios.get('/user/logOut')\n                .then(res => {\n                if (res.status === 200 && res.data.code === 0) {\n                    dispatch(logOutSuccess(res.data.data))\n                } else {\n                    dispatch(toDoFail(res.data.msg))\n                }\n            })\n    }\n}"]},"metadata":{},"sourceType":"module"}